#######
# PV5 #
#######
source("data-raw/hemibrain/startupHemibrain.R")

# First read all LHNs in the related cell body fibres
### Use plot3d(), nlscan() and find.neuron() to choose IDs.

# Group X
pv5x = c("728974338", "5812980156", "577546843", "727838223", "451355706",
         "573333903", "5813012375", "264779403", "546511447", "573683455",
         "573333284", "572651463", "609941228", "604368022",
         "696432315", "5813010159", "5813083717", "911012735", "541663112",
         "5813047130", "5812980282", "973047668", "759582005", "326159907",
         "295805243", "5813010180", "5813094592", "296153261", "573056433",
         "480931947", "5813047174", "390599254", "359529027", "880323994",
         "572647105", "573708714", "5813056026", "356144721", "419216386",
         "451646125", "485387561", "605063393", "702010197", "700982749",
         "639958133", "729228602", "264783939", "481268762", "573333575",
         "5813010200", "602999843", "608240515", "329220439", "633684017",
         "265120324", "696082279", "5813009281", "573670049",
         "579576294", "454706029",  "511267279", "5901213816",
         "265120223", "356823065"
)
# Group Y
pv5y = c("360587642", "513050445", "705722260", "611274992", "699203489",
         "636798093", "361269751", "732354059", "455751103", "360254994",
         "391273276", "573328182", "485728655", "422640861", "424025668",
         "611620813", "768132738", "763034485", "423343583", "728836965",
         "422307542", "5813009429", "5813078563", "732034061",
         "5812981264", "5812981543", "5813020828", "457175171", "487143497",
         "457196643", "673366098", "579916831", "580244333", "5813048099",
         "361964245", "5812981168", "851027931", "5901203559", "634069028",
         "5813048346", "456083341", "912049625", "487795196", "513058708",
         "634741770", "794333532", "482974860", "641631962", "573005505",
         "5901196176", "487467388", "641631806", "484355342", "701577869",
         "697853509", "731917767", "730325440", "575750788", "5813047222")
# Group z
pv5z = c("294787849", "579575594", "328611004", "517514142","299082033", "5813077562", "357224041")
pv5 = unique(c(pv5x,pv5y,pv5z))

## The PV5 assembly contains 3 cell body fibre bundles and 3 hemlineages

### CBFs:
### x: PDL05^SFS1 PDL08^pLH2 PDL19^SFS3 PDL23^pLH10 PDL14^pLH6
PDL05 = neuprint_read_neurons("PDL05")
PDL05 = PDL05[names(PDL05)%in%lhn.ids]
PDL23 = neuprint_read_neurons("PDL23")
PDL23 = PDL23[names(PDL23)%in%lhn.ids]
PDL22 = neuprint_read_neurons("PDL22")
PDL22 = PDL22[names(PDL22)%in%lhn.ids]
PDL19 = neuprint_read_neurons("PDL19")
PDL19 = PDL19[names(PDL19)%in%lhn.ids]
pv5.hemi = c(PDL05,PDL23,PDL22,PDL19)

### Re-define some of these CBFs
sd = setdiff(pv5, names(pv5.hemi))
ds = setdiff(names(pv5.hemi),pv5)
pv5 = unique(pv5, names(pv5.hemi))

### Set-up data.frame
df = subset(namelist, bodyid %in% pv5)
df$cbf.change = FALSE
df$cell.type = NA
rownames(df) = df$bodyid

### Wrong CBF
# PDL08 -> PDL23
wrong1 = c("356144721", "419216386", "451646125", "485387561")
df[wrong1,"cbf.change"] = "PDL23"

### Hemilineages:
#### ItoLee: Dl2_lateral, DL1_dorsal, DL2_medial
#### Hartenstein: CP3_lateral, CP2_dorsal, CP3_medial
df[pv5x,"ItoLee_Hemilineage"] = "Dl2_lateral"
df[pv5x,"Hartenstein_Hemilineage"] = "CP3_lateral"
df[pv5y,"ItoLee_Hemilineage"] = "DL1_dorsal"
df[pv5y,"Hartenstein_Hemilineage"] = "CP2_dorsal"
df[pv5z,"ItoLee_Hemilineage"] = "DL2_medial"
df[pv5z,"Hartenstein_Hemilineage"] = "CP3_medial"
df[pv5.primary,"ItoLee_Hemilineage"] = "primary"
df[pv5.primary,"Hartenstein_Hemilineage"] = "primary"


##############################
# Make and review cell types #
##############################

############
### PV5x ###
############
# hemibrain_type_plot(bodyids = a, meta = lh.meta, someneuronlist = db);plot3d(most.lhns.hemibrain[light],col="black")

#####
# a #
#####

a1= c("546511447", "573333903", "577546843","573333284", "573683455", "609941228", "604368022")
# light = c("Gad1-F-900137", "Gad1-F-500180", "Gad1-F-400275", "120708c1", "120813c0",
#           "Gad1-F-200403", "Gad1-F-200289", "Cha-F-400324", "Gad1-F-100357", "Gad1-F-200220",
#           "120628c1", "Cha-F-000427", "L378#2", "Gad1-F-100099", "L166#1", "L224#1", "Gad1-F-000338",
#           "Gad1-F-300298", "L224#3", "SS01372#1", "L166#5", "Cha-F-300204", "120216c0",
#           "120914c0", "130118c0", "Cha-F-100394", "Cha-F-300241", "Cha-F-400179", "Cha-F-500187", "Gad1-F-100093",
#           "Gad1-F-100247","Gad1-F-100322", "Gad1-F-400226", "Gad1-F-400226","Gad1-F-400335","Gad1-F-600214","L166#2",
#           "L166#3", "L224#2","L378#1","SS01372#2", "L166#6","SS01372#3")
df[a1,"cell.type"] = "PV5a1"

a2 = c("573670049", "579576294", "727838223", "696432315") # light = c("VGlut-F-400058", "L166#4", "Gad1-F-400304", "Gad1-F-200199","120712c1", "120619c1","120710c0",  "Cha-F-800011","Cha-F-100457", "120618c0","131118c3")
df[a2,"cell.type"] = "PV5a2"

a3 = c("264779403", "264783939", "481268762", "265120324", "265120223") # light = c("Gad1-F-700139", "Cha-F-500250", "Cha-F-700211",  "L163#1", "Gad1-F-000349","L163#2")
df[a3,"cell.type"] = "PV5a3"

a4 = c("5813009281", "5812980156") # light = c("Cha-F-200402", "Cha-F-500138")
df[a4,"cell.type"] = "PV5a4"

a5 = c("451355706", "572651463")
df[a5,"cell.type"] = "PV5a5"

#####
# d #
#####

d1 = c("633684017")
df[d2,"cell.type"] = "PV5d1"

d2 = c("5813010200", "602999843", "573333575", "329220439", "5813012375") # light = c("Gad1-F-900098", "Gad1-F-300321","L1554#2","MB036B#1", "Gad1-F-100023", "L1554#1", "Cha-F-800045","160121c1", "Cha-F-200082")
df[d2,"cell.type"] = "PV5d2"

d3 = c("295805243", "911012735", "573056433", "5813094592", "480931947","5813010180", "296153261") # light = c("Gad1-F-900040")
df[d3,"cell.type"] = "PV5d3"

d4 = c("454706029")
df[d4,"cell.type"] = "PV5d4"


#####
# g #
#####

g1 = c("700982749", "728974338") # light = c("L374#3","L374#10","L374#2", "L374#4","Gad1-F-200177", "L374#9", "L374#5","L374#6",)
df[n,"cell.type"] = "PV5g1"

g2 = c("486501502", "608240515", "5813129400", "5901208687")  # light = c("Gad1-F-300312", "L374#8")
df[m,"cell.type"] = "PV5g2"

g3 = c("639958133", "702010197")
df[m,"cell.type"] = "PV5g3"

g4 = c("973047668")
df[g4,"cell.type"] = "PV5g4"

#####
# j #
#####

j1 = c("541663112", "5813047130")
df[j1,"cell.type"] = "PV5j1"

j2 = c("729228602", "5901213816")
df[j2,"cell.type"] = "PV5j2"

j3 = c("5812980282") # PV4c4 ["VGlut-F-800074"]
df[j3,"cell.type"] = "PV5j3"

j4 = c("759582005", "880323994")
df[j4,"cell.type"] = "PV5j4"

j5 = c("359529027", "326159907", "5813056026")
df[j5,"cell.type"] = "PV5j5"

j6 = "356823065"
df[j6,"cell.type"] = "PV5j6"


#####
# h #
#####

h1 = c("605063393", "573708714", "5813083717")
df[h1,"cell.type"] = "PV5h1"

h2 = c("390599254", "511267279", "5813010159", "5813047174", "572647105")
df[h2,"cell.type"] = "PV5h2"

h3 = c("356144721", "419216386")
df[h3,"cell.type"] = "PV5h3"

h4 = c("451646125")
df[h4,"cell.type"] = "PV5h4"

h5 = c("485387561")
df[h5,"cell.type"] = "PV5h5"

#####
# i #
#####

i1 = c("357146296")
df[i1,"cell.type"] = "PV5i1"


############
### PV5z ###
############

#####
# e #
#####

e1 = "517514142" # PPL104 # light = c("TH-M-300021","TH-M-200014")
df[e1,"cell.type"] = "OTHER"

e2 = "328611004" # light = c("TH-M-100016")
df[e2,"cell.type"] = "PV5e1"

e3 = "294787849"
df[e3,"cell.type"] = "PV5e3"

e4 = c("579575594", "642504699") # bilat
df[e4,"cell.type"] = "PV5e3"

############
### PV5y ###
############

#########
# mbons #
#########

mbons = "487143497" # MBON24
df[mbons,"cell.type"] = "OTHER"

mbons = c("457175171", "579916831") # light = c("E0585-F-200015", "E0585-F-300042","Gad1-F-400259")
df[mbons,"cell.type"] = "OTHER"

mbons = "5813020828" #  MBON18
df[mbons,"cell.type"] = "OTHER"

mbons = c("457196643", "673366098", "5812981264", "5812981543") # light = c("Cha-F-800086","E0585-F-200005","Gad1-F-700088","Gad1-F-400293")
df[mbons,"cell.type"] = "OTHER"

#####
# k #
#####

k1 = c("5813078563", "732034061") # light = c("Gad1-F-300290","L528#1")
df[a,"cell.type"] = "PV5k1"

#####
# c #
#####

c2 = c("455751103", "485728655") # light = c("Cha-F-300025","L173#1","130605c1","Gad1-F-300155","Gad1-F-000125", "E0585-F-500009","E0585-F-300058", "Cha-F-100068", "130220c1", "130606c1", "130704c2","E0585-F-300069","121212c0","121213c0", "130313c1","130710c3", "E0585-F-300050")
df[c2,"cell.type"] = "PV5c2"

c1 = c("636798093", "422640861", "424025668", "699203489","422307542", "5813009429", "423343583", "728836965", "360254994", "361269751", "391273276", "573328182") # light = c("L1293#11", "L1293#8", "121227c2", "JJ137","Gad1-F-200232", "L1293#1", "L173#7", "L1293#2", "L173#2", "130711c1","E0585-F-500008", "E0585-F-400008", "E0585-F-300013", "E0585-F-300043", "E0585-F-300071","130816c2", "E0585-F-300052", "E0585-F-300073", "E0585-F-400013", "E0585-F-300020", "L1293#14","L178#2", "130208c1", "Gad1-F-200255", "L173#8", "L173#4", "130702c1", "130703c1","130712c1","130717c0", "130814c0", "Cha-F-000317",  "E0585-F-300033", "E0585-F-300040", "E0585-F-300047", "E0585-F-300070", "E0585-F-400002", "E0585-F-400005", "E0585-F-400011", "E0585-F-400025", "Gad1-F-000139", "Gad1-F-100003", "Gad1-F-900052", "L1293#10", "L1293#12","L1293#13","L1293#15", "L1293#3", "L1293#4", "L1293#5", "L1293#6", "L1293#7","L1293#9","L173#3","L173#5","L173#6","L173#9", "L178#1", "L178#3", "L178#4", "JJ98", "E0585-F-400018", "Cha-F-100141", "L1293#16","Cha-F-600051","JJ99","E0585-F-400009")
df[c1,"cell.type"] = "PV5c1"

c3 = c("768132738", "611620813", "763034485") # light = c("130617c3", "131126c3", "121217c0", "130211c3", "130617c3","131126c3", "131204c0", "JJ117", "JJ134")
df[c3,"cell.type"] = "PV5c3"

c4 = c("732354059")
df[c4,"cell.type"] = "PV5c4"

#####
# b #
#####

b1 = c("482974860", "731917767","5901196176", "634741770","513058708","730325440","513050445") # ] light = c("E0585-F-600002") light = c("Cha-F-100083", "Cha-F-200169") light = c("E0585-F-300063", "130425c1", "121130c0", "130213c0", "130214c1") # PV5b2? light = c("Cha-F-100264", "E0585-F-300066","E0585-F-400021", "E0585-F-400003")
df[b1,"cell.type"] = "PV5b1"

b2 = c("912049625", "456083341", "5812981168", "5901203559","487795196", "5813048346", "634069028") # light = c("Cha-F-700258", "Cha-F-700258", "Cha-F-700258")
df[b2,"cell.type"] = "PV5b2"

b3 = c("705722260", "575750788", "701577869", "851027931","573005505") # light = c("L849#2", "E0585-F-400028", "E0585-F-700002", "Cha-F-300342", "L849#1")
df[b3,"cell.type"] = "PV5b3"

b5 = c("484355342", "794333532") # light = c("E0585-F-400001")
df[b5,"cell.type"] = "PV5b5"

b6 = c("580244333", "487467388", "5813047222", "5813048099", "697853509") # new, but: light = c("Cha-F-200204", "E0585-F-700001", "E0585-F-800004")
df[b6,"cell.type"] = "PV5b7"

b7 = c("611274992", "641631806", "641631962")
df[b7,"cell.type"] = "PV5b8"

#####
# f #
#####

f1 = c("360587642", "361964245") # light = c("Gad1-F-400162",  "E0585-F-500000", "E0585-F-500001")
df[f1,"cell.type"] = "PV5f1"

#####
# j #
#####

j1 = "357224041"
df[j1,"cell.type"] = "PV5j1"

#####
# l #
#####

l1 = "5813077562"
df[l1,"cell.type"] = "PV5l1"


########
# save #
########

# Organise cell types
df = process_types(df)

# Update googlesheet
write_lhns(df = df, bodyids = pv5x, column = c())
write_lhns(df, pv5y)
write_lhns(df, pv5z)

c("bodyid", "type", "cbf", "m.type", "c.type", "cell.type", "ItoLee_Hemilineage",
  "Hartenstein_Hemilineage", "FAFB.match", "LM.match", "cbf.change",
  "type.change")
